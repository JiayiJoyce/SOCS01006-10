# set up(paste the path of working directory here----
pacman::p_load(
  tidyverse, # tidyverse pkgs including purrr
  kableExtra,#table
  flextable, #table
  glue, #combining strings and objects
  ggplot2) 
rm(list = ls())
setwd("  ")
energy_and_fuel <- read_csv("Number of people with and without energy access (OWID based on World Bank, 2021).csv")

# creating income-based entity dataset used in visualization-----
#make column names machine readable
energy_and_fuel<-janitor::clean_names(energy_and_fuel) 
#creating three new columns: total_population, percentage_with_electricity_access and percentage_with_clean_fuel_access
energy_and_fuel <- energy_and_fuel %>% 
  mutate(total_population = number_of_people_with_access_to_electricity +number_of_people_without_access_to_electricity) %>%
  mutate(percentage_with_electricity_access= number_of_people_with_access_to_electricity / total_population) %>%
  mutate(percentage_with_clean_fuel_access= number_with_clean_fuels_cooking/total_population)

#filtering out income-based entity and subsetting them into income_based_entity dataframe
income_based_entity <- energy_and_fuel %>%
  filter(str_detect(entity, "(?i)high|low|middle") & !str_detect(entity, "excluding")& str_detect(entity, "income"))


# data visualization----
create_point_plot <- function(i) {
  income_based_entity %>%
    ggplot(aes_string(x = names(income_based_entity)[2], y = names(income_based_entity)[i]),
           color = "entity") +
    geom_point() +
    geom_smooth(method = "lm", se = TRUE, color = "purple") +  # Add trend lin
    labs(
      title = glue("The Trend of {names(income_based_entity)[i]}"),
      y = glue("{names(income_based_entity)[i]}")
    )+
    scale_color_manual(values = c("blue", "red", "green","yellow","black"))
  
}

plots_list <- map(3:ncol(income_based_entity), create_point_plot)
plots_list

